# ============================================================================
# TEST RUNNER CONTROL - DECIDE WHAT TO RUN
# ============================================================================
# This top section controls what tests to run.
# Enable/disable options here. All detailed configurations are in the bottom section.

# Test execution settings
execution:
  default_run_time: 10
  term_timeout: 5
  human_verification_run_time: 25

# Logging configuration
logging:
  base_dir: "logs"
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  subdirectories:
    hef_tests: "logs/hef_tests"
    h8l_on_h8: "logs/h8l_on_h8_tests"
    h8l_on_h8_comprehensive: "logs/h8l_on_h8_comprehensive"
    human_verification: "logs/human_verification"

# What to run - choose one of these options:
# Option 1: Use test profiles (quick selection)
test_profiles:
  default_test_case:
    enabled: true  # Default test case: all pipelines, pythonpath with default/usb/rpi, cli/module with default only
  all:
    enabled: false
  quick:
    enabled: false
  all_pipelines:
    enabled: false
  detection_only:
    enabled: false
  hailo8_only:
    enabled: false
  hailo8l_only:
    enabled: false
  hailo10h_only:
    enabled: false
  hailo8l_on_hailo8:
    enabled: false
  human_verification:
    enabled: false
  retraining:
    enabled: false

# Option 2: Fine-grained selection (overrides profiles if set)
test_selection:
  pipelines: "all"  # "all" or list of pipeline names from bottom section
  architectures: "all"  # "all" or ["hailo8", "hailo8l", "hailo10h"]
  run_methods: "all"  # "all" or ["module", "pythonpath", "cli"]
  test_suites: ["default", "usb_camera", "rpi_camera"]  # List of test suite names from bottom section
  # Per-run-method test suites (overrides test_suites if specified)
  run_method_test_suites:
    pythonpath: ["default", "usb_camera", "rpi_camera"]  # All video sources for pythonpath
    cli: ["default"]  # Default, USB and RPi cameras for cli
    module: ["default"]  # Default, USB and RPi cameras for module

# Enable/disable specific pipelines (from bottom section)
enabled_pipelines:
  detection: true
  pose_estimation: true
  depth: true
  instance_segmentation: true
  simple_detection: true
  face_recognition: true
  multisource: true
  reid_multisource: true
  tiling: true

# Enable/disable run methods
enabled_run_methods:
  module: true
  pythonpath: true
  cli: true

# Enable/disable special tests
special_tests:
  hailo8l_on_hailo8: true
  retraining: true
  human_verification: true
  sanity_checks: true
  pipeline_specific: true  # Enable pipeline-specific special tests

# ============================================================================
# END OF CONTROL SECTION
# ============================================================================
# Everything below contains all available configurations.
# The runner reads these when enabled from the top section.
# ============================================================================

# ============================================================================
# ALL AVAILABLE CONFIGURATIONS
# ============================================================================

# Pipeline definitions - all available pipelines
pipelines:
  detection:
    name: "detection"
    description: "Object Detection Pipeline"
    module: "hailo_apps.python.pipeline_apps.detection.detection_pipeline"
    script: "hailo_apps/python/pipeline_apps/detection/detection_pipeline.py"
    cli: "hailo-detect"
    models:
      default:
        - yolov5m_wo_spp
        - yolov6n
        - yolov8s
        - yolov8m
        - yolov11n
        - yolov11s

  pose_estimation:
    name: "pose_estimation"
    description: "Pose Estimation Pipeline"
    module: "hailo_apps.python.pipeline_apps.pose_estimation.pose_estimation_pipeline"
    script: "hailo_apps/python/pipeline_apps/pose_estimation/pose_estimation_pipeline.py"
    cli: "hailo-pose"
    models:
      hailo8:
        - yolov8s_pose
        - yolov8m_pose
      hailo10h:
        - yolov8s_pose
        - yolov8m_pose
      hailo8l:
        - yolov8s_pose

  depth:
    name: "depth"
    description: "Depth Estimation Pipeline"
    module: "hailo_apps.python.pipeline_apps.depth.depth_pipeline"
    script: "hailo_apps/python/pipeline_apps/depth/depth_pipeline.py"
    cli: "hailo-depth"
    models:
      default:
        - scdepthv3

  instance_segmentation:
    name: "instance_segmentation"
    description: "Instance Segmentation Pipeline"
    module: "hailo_apps.python.pipeline_apps.instance_segmentation.instance_segmentation_pipeline"
    script: "hailo_apps/python/pipeline_apps/instance_segmentation/instance_segmentation_pipeline.py"
    cli: "hailo-seg"
    models:
      hailo8:
        - yolov5m_seg
      hailo8l:
        - yolov5n_seg
      hailo10h:
        - yolov5m_seg

  simple_detection:
    name: "simple_detection"
    description: "Simple Detection Pipeline"
    module: "hailo_apps.python.pipeline_apps.detection_simple.detection_pipeline_simple"
    script: "hailo_apps/python/pipeline_apps/detection_simple/detection_pipeline_simple.py"
    cli: "hailo-detect-simple"
    models:
      default:
        - yolov6n

  face_recognition:
    name: "face_recognition"
    description: "Face Recognition Pipeline"
    module: "hailo_apps.python.pipeline_apps.face_recognition.face_recognition"
    script: "hailo_apps/python/pipeline_apps/face_recognition/face_recognition.py"
    cli: "hailo-face-recon"
    models:
      hailo8:
        - scrfd_10g
        - arcface_mobilefacenet
      hailo8l:
        - scrfd_2.5g
        - arcface_mobilefacenet
      hailo10h:
        - scrfd_10g
        - arcface_mobilefacenet

  multisource:
    name: "multisource"
    description: "Multisource Pipeline"
    module: "hailo_apps.python.pipeline_apps.multisource.multisource_pipeline"
    script: "hailo_apps/python/pipeline_apps/multisource/multisource_pipeline.py"
    cli: "hailo-multisource"
    # Multisource uses simple_detection pipeline internally, which uses yolov6n
    # It doesn't accept --hef-path - it uses get_resource_path for SIMPLE_DETECTION_PIPELINE
    models:
      default:
        - yolov6n  # Only yolov6n - multisource uses simple_detection which only supports yolov6n

  reid_multisource:
    name: "reid_multisource"
    description: "REID Multisource Pipeline"
    module: "hailo_apps.python.pipeline_apps.reid_multisource.reid_multisource_pipeline"
    script: "hailo_apps/python/pipeline_apps/reid_multisource/reid_multisource_pipeline.py"
    cli: "hailo-reid"
    # REID multisource uses face detection and face recognition models internally
    # It doesn't accept --hef-path - it uses get_resource_path for:
    # - scrfd (face detection) - from FACE_DETECTION_PIPELINE
    # - arcface_mobilefacenet (face recognition) - from FACE_RECOGNITION_PIPELINE
    # The --hef-path argument is ignored by this pipeline
    # We use "default" as a placeholder model name for test framework compatibility
    models:
      default:
        - default  # Placeholder - pipeline uses internal face detection/recognition models

  tiling:
    name: "tiling"
    description: "Tiling Pipeline"
    module: "hailo_apps.python.pipeline_apps.tiling.tiling_pipeline"
    script: "hailo_apps/python/pipeline_apps/tiling/tiling_pipeline.py"
    cli: "hailo-tiling"
    models:
      default:
        - yolov6n
      hailo8:
        - ssd_mobilenet_v1_visdrone
      hailo8l:
        - ssd_mobilenet_v1_visdrone

# Run methods - all available run methods
run_methods:
  module:
    name: "module"
    description: "Run as Python module using -m flag"
  pythonpath:
    name: "pythonpath"
    description: "Run script with PYTHONPATH set"
  cli:
    name: "cli"
    description: "Run using CLI command"

# Test suites - all available test suites
test_suites:
  default:
    description: "Empty arguments - uses default behavior"
    args: []
  usb_camera:
    description: "Use USB camera as input"
    args: ["--input", "usb"]
  rpi_camera:
    description: "Use Raspberry Pi camera as input"
    args: ["--input", "rpi"]
  video_file:
    description: "Use video file as input"
    args: ["--input", "resources/example.mp4"]
  hef_path:
    description: "Specify HEF path explicitly"
    args: ["--hef-path", "${HEF_PATH}"]
  disable_sync:
    description: "Disable synchronization"
    args: ["--disable-sync"]
  disable_callback:
    description: "Disable callback"
    args: ["--disable-callback"]
  show_fps:
    description: "Show FPS counter"
    args: ["--show-fps"]
  labels:
    description: "Use labels JSON file"
    args: ["--labels-json", "resources/labels.json"]
  mode-train:
    description: "Set mode to train (for face recognition)"
    args: ["--mode", "train"]
  mode-delete:
    description: "Set mode to delete (for face recognition)"
    args: ["--mode", "delete"]
  sources:
    description: "Specify multiple sources (for multisource/reid)"
    args: ["--sources", "/dev/video0,${RESOURCES_ROOT}/videos/example.mp4"]
  general_detection:
    description: "Use general detection mode (for tiling)"
    args: ["--general-detection"]

# Test profiles - all available profiles with their configurations
test_profiles_config:
  default_test_case:
    description: "Default test case: all pipelines, all run methods with default/usb/rpi cameras"
    pipelines: "all"
    architectures: "all"
    run_methods: ["pythonpath", "cli", "module"]
    run_method_test_suites:
      pythonpath: ["default", "usb_camera", "rpi_camera"]
      cli: ["default", "usb_camera", "rpi_camera"]
      module: ["default", "usb_camera", "rpi_camera"]
  all:
    description: "Run all available tests"
    includes:
      - sanity_checks
      - all_pipelines
      - hailo8l_on_hailo8
      - retraining
      - human_verification
  quick:
    description: "Quick test - one model per pipeline"
    includes:
      - sanity_checks
      - pipeline_quick
  all_pipelines:
    description: "Test all pipelines with all models"
    includes:
      - all_pipelines
  detection_only:
    description: "Test only detection pipeline"
    pipelines: ["detection"]
  hailo8_only:
    description: "Test only Hailo8 architecture"
    architectures: ["hailo8"]
  hailo8l_only:
    description: "Test only Hailo8L architecture"
    architectures: ["hailo8l"]
  hailo10h_only:
    description: "Test only Hailo10H architecture"
    architectures: ["hailo10h"]
  hailo8l_on_hailo8:
    description: "Test Hailo8L models running on Hailo8 device"
    includes:
      - hailo8l_on_hailo8
  human_verification:
    description: "Human verification tests (25s per app)"
    includes:
      - human_verification
  retraining:
    description: "Retraining pipeline tests"
    includes:
      - retraining

# Hailo8L on Hailo8 compatibility tests configuration
# This section references models from pipeline configurations (hailo8l architecture)
# No duplication - models are taken from the pipelines section above
hailo8l_on_hailo8_tests:
  log_dir: "logs/h8l_on_h8_comprehensive"
  # Models are automatically taken from pipelines[<pipeline_name>].models.hailo8l
  # This tests hailo8l models running on hailo8 devices for compatibility

# Retraining test configuration
retraining:
  model: "yolov8s-hailo8l-barcode"
  video: "barcode.mp4"
  labels_json: "barcode_labels.json"
  hef_path: "${RESOURCES_ROOT}/models/hailo8l/yolov8s-hailo8l-barcode.hef"
  video_path: "${RESOURCES_ROOT}/videos/barcode.mp4"
  labels_path: "${RESOURCES_ROOT}/json/barcode_labels.json"

# Sanity check configuration
sanity_checks:
  required_packages:
    - gi
    - numpy
    - opencv-python
    - hailo
  optional_packages:
    - setproctitle
    - python-dotenv
    - picamera2
  gstreamer_elements:
    critical:
      - videotestsrc
      - appsink
      - videoconvert
      - autovideosink
    hailo:
      - hailonet
      - hailofilter
  required_resources:
    - example.mp4
    - example_640.mp4
    - face_recognition.mp4
    - tiling_visdrone_720p.mp4
    - libdepth_postprocess.so
    - libyolo_hailortpp_postprocess.so
    - libyolov5seg_postprocess.so
    - libyolov8pose_postprocess.so

# Human verification test configuration
human_verification:
  run_time: 25
  term_timeout: 5
  log_dir: "logs/human_verification"
  apps:
    - name: "detection"
      description: "Object Detection App"
    - name: "depth"
      description: "Depth Estimation App"
    - name: "face_recognition"
      description: "Face Recognition App"
    - name: "instance_segmentation"
      description: "Instance Segmentation App"
    - name: "pose_estimation"
      description: "Pose Estimation App"
    - name: "detection_simple"
      description: "Simple Detection App"
    - name: "multisource"
      description: "Multisource App"
    - name: "reid_multisource"
      description: "REID Multisource App"
    - name: "tiling"
      description: "Tiling App"

# Pipeline-specific special tests
# These tests are run in addition to the standard tests for each pipeline
pipeline_special_tests:
  detection:
    description: "Special tests for detection pipeline"
    enabled: true
    tests:
      - name: "labels_test"
        description: "Test with labels JSON file"
        test_suite: "labels"
        run_methods: ["pythonpath"]
      - name: "disable_sync_test"
        description: "Test with sync disabled"
        test_suite: "disable_sync"
        run_methods: ["pythonpath"]
  
  pose_estimation:
    description: "Special tests for pose estimation pipeline"
    enabled: true
    tests:
      - name: "show_fps_test"
        description: "Test with FPS display"
        test_suite: "show_fps"
        run_methods: ["pythonpath"]
  
  depth:
    description: "Special tests for depth pipeline"
    enabled: true
    tests:
      - name: "disable_callback_test"
        description: "Test with callback disabled"
        test_suite: "disable_callback"
        run_methods: ["pythonpath"]
  
  instance_segmentation:
    description: "Special tests for instance segmentation pipeline"
    enabled: true
    tests:
      - name: "labels_test"
        description: "Test with labels JSON file"
        test_suite: "labels"
        run_methods: ["pythonpath"]
  
  simple_detection:
    description: "Special tests for simple detection pipeline"
    enabled: true
    tests: []
  
  face_recognition:
    description: "Special tests for face recognition pipeline"
    enabled: true
    tests:
      - name: "mode_train_test"
        description: "Test training mode"
        test_suite: "mode-train"
        run_methods: ["pythonpath"]
      - name: "mode_delete_test"
        description: "Test delete mode"
        test_suite: "mode-delete"
        run_methods: ["pythonpath"]
  
  multisource:
    description: "Special tests for multisource pipeline"
    enabled: true
    tests:
      - name: "sources_test"
        description: "Test with multiple sources"
        test_suite: "sources"
        run_methods: ["pythonpath"]
  
  reid_multisource:
    description: "Special tests for REID multisource pipeline"
    enabled: true
    tests:
      - name: "sources_test"
        description: "Test with multiple sources"
        test_suite: "sources"
        run_methods: ["pythonpath"]
  
  tiling:
    description: "Special tests for tiling pipeline"
    enabled: true
    tests:
      - name: "general_detection_test"
        description: "Test general detection mode"
        test_suite: "general_detection"
        run_methods: ["pythonpath"]

# Resource paths
resources:
  root_path: "/usr/local/hailo/resources"
  videos:
    default: "example.mp4"
    example_640: "example_640.mp4"
    face_recognition: "face_recognition.mp4"
    barcode: "barcode.mp4"
    tiling_visdrone: "tiling_visdrone_720p.mp4"
  # Pipeline-specific video configuration
  # If a pipeline needs a different video, specify it here
  # Otherwise, the default video will be used
  pipeline_videos:
    detection: "example.mp4"
    pose_estimation: "example.mp4"
    depth: "example.mp4"
    instance_segmentation: "example.mp4"
    simple_detection: "example.mp4"
    face_recognition: "face_recognition.mp4"
    multisource: "example.mp4"
    reid_multisource: "example.mp4"
    tiling: "tiling_visdrone_720p.mp4"
  json:
    labels: "labels.json"
    barcode_labels: "barcode_labels.json"
    scrfd: "scrfd.json"
    yolov5m_seg: "yolov5m_seg.json"
    yolov5n_seg: "yolov5n_seg.json"

# ============================================================================
# DOCUMENTATION
# ============================================================================
#
# HOW IT WORKS:
# -------------
# 1. Top section (above "END OF CONTROL SECTION") - Controls what to run
#    - Enable/disable test profiles
#    - Set test_selection options
#    - Enable/disable specific pipelines
#    - Enable/disable run methods
#    - Enable/disable special tests
#
# 2. Bottom section (below "END OF CONTROL SECTION") - All available configurations
#    - All pipeline definitions with models
#    - All run methods
#    - All test suites
#    - All test profile configurations
#    - Special test configurations
#
# USAGE EXAMPLES:
# --------------
#
# Example 1: Use a profile
#   test_profiles:
#     quick:
#       enabled: true
#
# Example 2: Fine-grained selection
#   test_selection:
#     pipelines: ["detection", "pose_estimation"]
#     architectures: ["hailo8"]
#     run_methods: ["cli"]
#     test_suites: ["default", "video_file"]
#
# Example 3: Disable specific pipeline
#   enabled_pipelines:
#     face_recognition: false
#
# Example 4: Enable only CLI method
#   enabled_run_methods:
#     module: false
#     pythonpath: false
#     cli: true
#
# PLACEHOLDERS:
# ------------
#   ${RESOURCES_ROOT}  - Replaced with /usr/local/hailo/resources
#   ${HEF_PATH}        - Replaced with actual HEF file path
#   ${HAILO_ARCH}      - Replaced with detected Hailo architecture
#   ${HOST_ARCH}       - Replaced with detected host architecture
#
# FOR MORE INFORMATION:
# ---------------------
# See tests/CONFIG_DOCUMENTATION.md for complete documentation.
